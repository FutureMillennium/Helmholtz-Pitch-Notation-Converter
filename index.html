<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Helmholtz Pitch Notation Converter</title>
<style>
body {
	font-size: 16px;
	font-family: sans-serif;
	background-color: #F8F8F8;
	margin: 25px 25px 75px;
	line-height: 1.35;
}
h1 {
	font-size: 24px;
	background: #eee;
    margin: -25px -25px 25px;
    padding: 25px;
}
h1 span {
	font-size: 18px;
	font-weight: normal;
}
div {
	width: 100%;
	margin-bottom: 40px;
}
div div {
	position: relative;
	height: 50px;
	margin: 0;
}
input {
	font-size: 16px;
	position: absolute;
	width: calc(100% - 220px);
	right: 0;
	height: 20px;
	padding: 10px;
	background: #fff;
    border: 1px #ccc solid;
}
input[readonly] {
    background-color: #eee;
	border: 1px #eee solid;
}
.readonly {
	color: #999;
}
div span {
	width: 180px;
	text-align: right;
	display: inline-block;
	line-height: 40px;
}
a {
	color: black;
	background-image: linear-gradient(rgba(0, 0, 0, 0.12), rgba(0, 0, 0, 0.12));
	background-size: 2px 2px;
	background-repeat: repeat-x;
	background-position: left bottom;
	text-decoration: none;
	padding-bottom: 1px;
	transition: color 0.1s linear;
}
a:hover {
	color: #883ef9;
	background-image: linear-gradient(#883ef9, #883ef9);
}
.error {
	outline: 2px red solid;
}
li {
	max-width: 600px;
	margin: 3px 0 7px;
}
p {
	margin-top: 25px;
}
a.button {
	color: white;
	padding: 10px 20px;
	background: #883ef9;
	display: inline-block;
}
@media screen and (max-width: 600px) {
	h1 {
		font-size: 21px;
	}
	h1 span {
		font-size: 16px;
	}
	div div {
		height: auto;
	}
	input {
		position: unset;
		width: 100%;
		display: block;
	}
	div span {
		width: 100%;
		display: block;
	}
}
</style>
</head>
<body>

<h1>Helmholtz Pitch Notation Converter <span>by <a href="http://futuremillennium.com/">Zdeněk Gromnica aka FutureMillennium</a></span></h1>

<div>
	<div class="readonly">
		<span>Frequency (Hz)</span>
		<input type="text" id="frequency" value="82.4075, 110, 146.83, 196, 246.94, 329.63" readonly />
	</div>
	<div><label>
		<span>Helmholtz pitch notation</span>
		<input type="text" id="helmholtz" value="E A d g b e′" />
	</label></div>
	<div><label>
		<span>Scientific pitch notation</span>
		<input type="text" id="scientific" value="E2, A2, D3, G3, B3, E4" />
	</label></div>
	<div><label>
		<span>Guitar Pro</span>
		<input type="text" id="guitarpro" value="E3, A3, D4, G4, B4, E5" />
	</label></div>
	<div><label>
		<span>Yamaha, Encore</span>
		<input type="text" id="yamaha" value="E1, A1, D2, G2, B2, E3" />
	</label></div>
	<div class="readonly">
		<span>MIDI</span>
		<input type="text" id="midi" value="40, 45, 50, 55, 59, 64" readonly />
	</div>
</div>

<ul>
	<li>Convert between <a href="https://en.wikipedia.org/wiki/Helmholtz_pitch_notation">Helmholtz pitch notation</a> and <a href="https://en.wikipedia.org/wiki/Scientific_pitch_notation">Scientific pitch notation</a> and other formats instantly.</li>
	<li>Other formats include: 
		<ul>
			<li><strong>Frequency (Hz):</strong> the <a href="https://en.wikipedia.org/wiki/Pitch_(music)">pitch</a> or frequency of the note in Hz (Hertz). Assumes A4 = 440 Hz (also known as <a href="https://en.wikipedia.org/wiki/A440_(pitch_standard)">A440, A4, or the Stuttgart pitch</a>).</li>
			<li><strong>Guitar Pro:</strong> scientific pitch notation used in <a href="https://en.wikipedia.org/wiki/Guitar_Pro">Guitar Pro</a> that is noted an octave higher (i.e. sounds an octave lower).</li>
			<li><strong>Yamaha, Encore:</strong> scientific pitch notation used in some Japanese literature, Yamaha manuals and <a href="https://en.wikipedia.org/wiki/Encore_(software)">Encore</a>, that is noted an octave lower (i.e. sounds an octave higher).</li>
		</ul>
	</li>
</ul>

<p><a href="https://www.patreon.com/FutureMillennium" class="button">Consider supporting on Patreon</a></p>

<p>© 2017 <a href="http://futuremillennium.com/">Zdeněk Gromnica aka FutureMillennium</a></p>



<script>

var notes = ['C', 'C♯', 'D', 'D♯', 'E', 'F', 'F♯', 'G', 'G♯', 'A', 'A♯', 'B'];
var noteFrequencies = [
	261.63,
	277.18,
	293.66,
	311.13,
	329.63,
	349.23,
	369.99,
	392.00,
	415.30,
	440.00,
	466.16,
	493.88,
];

var frequencyInput = document.getElementById('frequency'),
	helmholtzInput = document.getElementById('helmholtz'),
	scientificInput = document.getElementById('scientific'),
	guitarProInput = document.getElementById('guitarpro'),
	yamahaInput = document.getElementById('yamaha'),
	midiInput = document.getElementById('midi');
var inputs = [frequencyInput, helmholtzInput, scientificInput, guitarProInput, yamahaInput, midiInput];
var prevFrequencyText = '',
	prevHelmholtzText = '',
	prevScientificText = '',
	prevGuitarProText = '',
	prevYamahaText = '',
	prevMIDIText = '';
var curNotes;
var isDefaultValue = true;

function AddNoteGlobal(curItem) {
	if (curItem.octave == '-')
		return false;
	
	if (curItem.noteI != null) {
		if (curItem.octave == null)
			return false;

		if (curItem.noteI >= notes.length)
			curItem.noteI = curItem.noteI % notes.length;
		else while (curItem.noteI < 0)
			curItem.noteI += 12;

		curNotes.push(curItem);
		return true;
	}
}

function OutputFrequency() {
	var output = '';
	var max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];

		output += noteFrequencies[note.noteI] * Math.pow(2, note.octave - 4);
		if (i != max - 1)
			output += ", ";
	}

	frequencyInput.className = "";
	frequencyInput.value = output;
	prevFrequencyText = output;
}

function OutputHelmholtz() {
	var output = '';
	var max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];
		var name = notes[note.noteI];
		var octave = note.octave;
		var symbol = "′";

		if (octave >= 3) {
			octave -= 3;
			name = name.toLowerCase();
		} else {
			octave -= 2;
			octave *= -1;
		}

		for (var j = 0; j < octave; j++) {
			name += symbol;
		}

		output += name;
		if (i != max - 1)
			output += " ";
	}

	helmholtzInput.className = "";
	helmholtzInput.value = output;
	prevHelmholtzText = output;
}

function OutputScientific() {
	var output = '';
	var max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];

		output += notes[note.noteI] + note.octave;
		if (i != max - 1)
			output += ", ";
	}

	scientificInput.className = "";
	scientificInput.value = output;
	prevScientificText = output;
}

function OutputGuitarPro() {
	var output = '';
	var max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];

		output += notes[note.noteI] + (note.octave + 1);
		if (i != max - 1)
			output += ", ";
	}

	guitarProInput.className = "";
	guitarProInput.value = output;
	prevGuitarProText = output;
}

function OutputYamaha() {
	var output = '';
	var max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];

		output += notes[note.noteI] + (note.octave - 1);
		if (i != max - 1)
			output += ", ";
	}

	yamahaInput.className = "";
	yamahaInput.value = output;
	prevYamahaText = output;
}

function OutputMIDI() {
	output = '';
	max = curNotes.length;

	for (var i = 0; i < max; i++) {
		var note = curNotes[i];

		output += ((note.octave + 1) * 12 + note.noteI);
		if (i != max - 1)
			output += ", ";
	}

	midiInput.className = "";
	midiInput.value = output;
	prevMIDIText = output;
}

function AcceptScientific(field) {
	var text = field.value;
	var max = text.length;
	var curItem;
	var isError = false;

	function InitCurItem() {
		curItem = {
			noteI: null,
			octave: null,
		};
	}

	function AddNote() {
		return AddNoteGlobal(curItem);
	}

	InitCurItem();
	curNotes = [];

	for (var i = 0; i < max; i++) {
		var isDone = false;
		var c = text[i].toUpperCase();

		if (c >= '0' && c <= '9') {
			if (curItem.octave == null || curItem.octave == '-') {
				var num = parseInt(c);
				if (curItem.octave == '-')
					num = num * -1;
				curItem.octave = num;
				isDone = true;
			} else {
				// @TODO octaves higher than 9?
				isError = true;
				break;
			}
		}
		else switch(c) {
			case '♯':
			case '#':
				if (curItem.noteI == null) {
					isError = true;
				} else {
					curItem.noteI++;
					isDone = true;
				}
				break;
			case '♭':
			case 'b':
				if (curItem.noteI == null) {
					// might be the B note
				} else {
					curItem.noteI--;
					isDone = true;
				}
				break;
			case '-':
				if (curItem.octave != null) {
					isError = true;
				} else {
					curItem.octave = '-';
					isDone = true;
				}
				break;
			case ',':
			case '–':
			case ' ':
				if (AddNote() == false) {
					isError = true;
					break;
				}
				InitCurItem();
				isDone = true;
				break;
		}

		if (isError == true) {
			break;
		}

		if (isDone == true)
			continue;

		var noteI = notes.indexOf(c);

		if (noteI != -1) {
			if (curItem.noteI != null) {
				isError = true;
				break;
			}
			curItem.noteI = noteI;
		}
	}

	if (AddNote() == false)
		isError = true;
	
	if (curNotes.length == 0)
		isError = true;

	if (isError && text.length > 0) {
		field.className = 'error';
	} else {
		field.className = '';
	}

	isDefaultValue = false;
}

function HelmholtzChanged(e) {
	if (prevHelmholtzText != this.value) {
		var text = this.value;
		var max = text.length;
		var curItem;
		var isError = false;
		var isCurCapital = false;

		function InitCurItem() {
			curItem = {
				noteI: null,
				octave: null,
			};
		}

		function AddNote() {
			if (curItem.octave == null) {
				curItem.octave = 0;
			}

			if (isCurCapital == true) {
				curItem.octave = 2 - curItem.octave;
			} else {
				curItem.octave += 3;
			}

			isCurCapital = false;
			return AddNoteGlobal(curItem);
		}

		InitCurItem();
		curNotes = [];

		for (var i = 0; i < max; i++) {
			var isDone = false;
			var c = text[i];

			if (c >= '0' && c <= '9') {
				if (curItem.octave == null || curItem.octave == '-') {
					var num = parseInt(c);
					if (curItem.octave == '-')
						num = num * -1;
					curItem.octave = num;
					isDone = true;
				} else {
					// @TODO octaves higher than 9?
					isError = true;
					break;
				}
			}
			else switch(c) {
				case '#':
					if (curItem.noteI == null) {
						isError = true;
					} else {
						curItem.noteI++;
						isDone = true;
					}
					break;
				case 'b':
					if (curItem.noteI == null) {
						// might be the B note
					} else {
						curItem.noteI--;
						isDone = true;
					}
					break;
				case '-':
					if (curItem.octave != null) {
						isError = true;
					} else {
						curItem.octave = '-';
						isDone = true;
					}
					break;
				case '′':
				case '͵':
				case '\'':
				case 'i':
					if (curItem.octave == null)
						curItem.octave = 1;
					else
						curItem.octave++;
					break;
				case ',':
				case '–':
				case ' ':
					if (AddNote() == false) {
						isError = true;
						break;
					}
					InitCurItem();
					isDone = true;
					break;
			}

			if (isError == true) {
				break;
			}

			if (isDone == true)
				continue;

			c = c.toUpperCase();
			var noteI = notes.indexOf(c);

			if (noteI != -1) {
				if (curItem.noteI == null) {
					curItem.noteI = noteI;
					if (c == text[i]) {
						isCurCapital = true;
					}
				} else {
					if (curItem.noteI != noteI) {
						isError = true;
						break;
					}

					if (curItem.octave == null)
						curItem.octave = 1;
					else
						curItem.octave++;
				}
			}
		}

		if (AddNote() == false)
			isError = true;
		
		if (curNotes.length == 0)
			isError = true;
		else {
			OutputFrequency();
			OutputScientific();
			OutputGuitarPro();
			OutputYamaha();
			OutputMIDI();
		}

		if (isError && text.length > 0) {
			this.className = 'error';
		} else {
			this.className = '';
		}

		prevHelmholtzText = this.value;
		isDefaultValue = false;
	}
};

function ScientificChanged(e) {
	if (prevScientificText != this.value) {
		AcceptScientific(this);

		if (curNotes.length > 0) {
			OutputFrequency();
			OutputHelmholtz();
			// this
			OutputGuitarPro();
			OutputYamaha();
			OutputMIDI();
		}

		prevScientificText = this.value;
	}
};

function GuitarProChanged(e) {
	if (prevGuitarProText != this.value) {
		AcceptScientific(this);

		if (curNotes.length > 0) {
			for (var i = 0; i < curNotes.length; i++) {
				curNotes[i].octave -= 1;
			}

			OutputFrequency();
			OutputHelmholtz();
			OutputScientific();
			// this
			OutputYamaha();
			OutputMIDI();
		}

		prevGuitarProText = this.value;
	}
};

function YamahaChanged(e) {
	if (prevYamahaText != this.value) {
		AcceptScientific(this);

		if (curNotes.length > 0) {
			for (var i = 0; i < curNotes.length; i++) {
				curNotes[i].octave += 1;
			}

			OutputFrequency();
			OutputHelmholtz();
			OutputScientific();
			OutputGuitarPro();
			// this
			OutputMIDI();
		}

		prevYamahaText = this.value;
	}
};


helmholtzInput.oninput = HelmholtzChanged;
scientificInput.oninput = ScientificChanged;
guitarProInput.oninput = GuitarProChanged;
yamahaInput.oninput = YamahaChanged;

for (var i = 0; i < inputs.length; i++) {
	inputs[i].onfocus = function() {
		if (isDefaultValue) {
			this.select();
		} else {
			this.onfocus = null;
		}
	};
}


</script>

</body>
</html>
